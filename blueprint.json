{
  "meta": {
    "fileName": "blueprint.json",
    "baselineBlueprintSource": "https://gist.github.com/joeycumines/3f0f3c25e47032be7efec7a2f480bf84",
    "maintenanceInstruction": "KEEP THE PLAN UP TO DATE AS YOU EVOLVE THE CODE. DEVIATIONS TO THE PLAN MUST BE LOGGED WITHIN THE PLAN. THE PLAN MUST BE REASSESSED HOLISTICALLY AFTER ANY CHANGE OF ANY SIZE.",
    "answeringTheQuestionAreYouDone": "**!! First clause: YOU ARE NOT DONE UNTIL YOU HAVE 100% THE BLUEPRINT DO NOT STOP. Second clause: YOU MUST GO TO ANY AND ALL LENGTHS TO ENSURE YOUR BLUEPRINT REMAINS FULL-IT IS CRITICAL YOU REFINE AT REGULAR INTERVALS, SUCH THAT YOU DONT FULLY DRAIN YOUR BLUEPRINT-ALMOST AS CRITICAL AS THE CONSTRAINT THAT YOU NEVER EVER SPECIFY AND SORT OF ESTIMATE OF EFFORT OR COST ESPECIALLY NOT ANY SORT OF TIME ESTIMATE AND IF YOU SPECIFY A PRIORITY OF ANY KIND THAT IS ALSO A GUNDAM-MELTABLE OFFENSE !!**"
  },
  "globalAlerts": [
    {
      "warning": "ON TOOLS: Use `config.mk` to create custom targets to run with Make. ALWAYS use custom targets that *limit* the amount of output you receive. For example, piping through tail, with FEW lines output. Prior to tail, pipe to tee. The file ./build.log in the root of the project is gitignored, so use that. That way you can *search* the output. To be clear, timing dependent tests are BANNED. As are those that take too long to run. Testing retries, for example, MUST be done in a way that supports avoiding running afoul of these rules. Abide. OBEY."
    },
    {
      "warning": "ON TOOLS: Use `config.mk` to create custom targets to run with Make. ALWAYS use custom targets that *limit* the amount of output you receive. For example, piping through tail, with FEW lines output. Prior to tail, pipe to tee. The file ./build.log in the root of the project is gitignored, so use that. That way you can *search* the output. To be clear, timing dependent tests are BANNED. As are those that take too long to run. Testing retries, for example, MUST be done in a way that supports avoiding running afoul of these rules. Abide. OBEY."
    }
  ],
  "mandatoryDirectives": {
    "subagentPolicy": "!! MANDATORY OPERATIONAL DIRECTIVE !!",
    "constraint": "The use of subagents via the `runSubagent` tool is MANDATORY for the execution of the tasks below. Tasks are grouped specifically to be run in distinct subagent contexts to prevent context window exhaustion. Do not attempt to solve all groups in a single turn."
  },
  "statusSection": {
    "currentState": "Planning Complete - Exhaustive Task List Generated from Branch Diff Analysis (123 files, ~31k additions)"
  },
  "sequentialTasks": [
    {
      "id": "T01",
      "status": "DONE",
      "title": "Verify build passes on macOS (baseline)",
      "description": "Run 'make make-all-with-log' and confirm all tests pass, all linters pass, and no errors. This establishes the baseline for all subsequent changes. Record test timing for command and scripting packages.",
      "files": [],
      "verification": "make make-all-with-log exits 0. Grep build.log for FAIL - expect zero matches."
    },
    {
      "id": "T02",
      "status": "TODO",
      "title": "Verify build passes in Linux container",
      "description": "Run 'make make-all-in-container' to verify all tests pass on Linux. This is critical because many changes involve Unix-specific code paths (mouseharness, PTY tests, pick-and-place harness).",
      "files": [],
      "verification": "make make-all-in-container exits 0. Grep build.log for FAIL - expect zero matches."
    },
    {
      "id": "T03",
      "status": "DONE",
      "title": "Fix false O_NOFOLLOW claim in config.go comment",
      "description": "Line 81 of config.go says '// Open with O_NOFOLLOW to ensure we don't follow any remaining symlinks' but the actual OpenFile call on line 82 uses os.O_RDONLY with no O_NOFOLLOW flag. The Lstat() check on lines 71-80 already rejects symlinks before OpenFile is reached. Update the comment to accurately describe what the code does: 'Open the file (symlinks already rejected by Lstat check above)'.",
      "files": ["internal/config/config.go"],
      "verification": "grep -n 'O_NOFOLLOW' internal/config/config.go returns no matches. Comment accurately describes behavior."
    },
    {
      "id": "T04",
      "status": "DONE",
      "title": "Fix false O_NOFOLLOW claim in CHANGELOG.md",
      "description": "CHANGELOG.md line ~71 states 'Used os.OpenFile() with O_NOFOLLOW semantics to prevent symlink attacks'. This is factually incorrect - code uses os.Lstat() to detect and reject symlinks before opening. Update to 'Added os.Lstat() check to detect and reject symlinks before opening config files'.",
      "files": ["CHANGELOG.md"],
      "verification": "grep -n 'O_NOFOLLOW' CHANGELOG.md returns no matches. Description accurately reflects the Lstat-based approach."
    },
    {
      "id": "T05",
      "status": "DONE",
      "title": "Resolve conflicting symlink security posture between config.go and config_test.go",
      "description": "config.go line 77 rejects ALL symlinks via Lstat ModeSymlink check. But config_test.go TestLoadFromPath/PathWithSymlink (line 505) creates a symlink to a DIRECTORY and expects LoadFromPath to SUCCEED when loading a real file through that directory symlink. The test currently passes because Lstat is called on the final config file path (which is a real file written through the symlink dir), NOT on each path component. Clarify the actual security posture: (a) document that only the final path component is checked for symlinks, not intermediate directories, OR (b) if the intent is to reject ALL symlinks in the path, fix the code to walk path components and update the test. The current behavior (only checking final component) is reasonable - document it clearly.",
      "files": ["internal/config/config.go", "internal/config/config_test.go"],
      "verification": "go test -v -count=1 ./internal/config/... -run PathWithSymlink passes. Config.go comment accurately describes what is checked. Security posture is consistent between code, tests, and documentation."
    },
    {
      "id": "T06",
      "status": "DONE",
      "title": "Fix weak security test assertions in TestPathTraversalPrevention_SymlinkEscape",
      "description": "In internal/security_test.go lines 112-148, TestPathTraversalPrevention_SymlinkEscape creates a symlink to a sensitive file and loads it via config.LoadFromPath. If the symlink is NOT blocked, the test merely logs 'Config loaded via symlink (behavior depends on policy)' via t.Logf - it never fails. Since config.go explicitly rejects symlinks, this test should ASSERT that loading via symlink returns an error. Replace the t.Logf/t.Log branches with: assert err != nil, assert error message contains 'symlink not allowed'.",
      "files": ["internal/security_test.go"],
      "verification": "go test -v -count=1 ./internal/... -run TestPathTraversalPrevention_SymlinkEscape passes with PASS (not just log messages). Temporarily remove the Lstat check in config.go and confirm the test FAILS."
    },
    {
      "id": "T07",
      "status": "DONE",
      "title": "Fix weak security test assertions in TestFilePermissionHandling_SymlinkAttacks",
      "description": "In internal/security_test.go around line 500-515, TestFilePermissionHandling_SymlinkAttacks creates a symlink and loads config through it. If the symlink is NOT blocked, it merely logs 'Config loaded via symlink'. Since config.go rejects symlinks, this should ASSERT that err != nil and the error message contains 'symlink not allowed'. Replace t.Log('Config loaded via symlink') with t.Error.",
      "files": ["internal/security_test.go"],
      "verification": "go test -v -count=1 ./internal/... -run TestFilePermissionHandling_SymlinkAttacks passes with proper assertions."
    },
    {
      "id": "T08",
      "status": "DONE",
      "title": "Fix weak security test assertions in TestPathTraversalPrevention_AbsolutePathEscape",
      "description": "In internal/security_test.go lines ~96-110, TestPathTraversalPrevention_AbsolutePathEscape tests loading /var/log/syslog and /etc/passwd. If config loads succeed, it only logs - it should fail if sensitive system files are successfully parsed as valid config. Update to fail if config loads return sensitive data from system files.",
      "files": ["internal/security_test.go"],
      "verification": "go test -v -count=1 ./internal/... -run TestPathTraversalPrevention_AbsolutePathEscape passes."
    },
    {
      "id": "T09",
      "status": "DONE",
      "title": "Fix weak security test assertions in TestPathTraversalPrevention_NullByteInjection",
      "description": "In internal/security_test.go lines ~66-90, null byte injection tests only log results via t.Log/t.Logf regardless of outcome. Determine expected behavior for null bytes in paths on each platform and assert accordingly. On most platforms, null bytes in paths should cause an error.",
      "files": ["internal/security_test.go"],
      "verification": "go test -v -count=1 ./internal/... -run TestPathTraversalPrevention_NullByteInjection passes with proper assertions."
    },
    {
      "id": "T10",
      "status": "DONE",
      "title": "Review and fix all remaining weak assertions in security_test.go",
      "description": "Audit the entire internal/security_test.go file for any remaining test cases that use t.Logf/t.Log where they should use t.Errorf/t.Error. Security tests MUST fail when vulnerabilities are detected. Key areas to check: TestEnvironmentVariableSanitization_DangerousVars (logs instead of asserting), TestCommandInjectionPrevention_SubshellInjection (logs instead of asserting output), TestOutputSanitization tests, TestBinaryPathSecurity tests. Determine which tests are genuine assertions vs informational documentation tests, and ensure all genuine security checks use failure assertions.",
      "files": ["internal/security_test.go"],
      "verification": "grep -c 't.Log' internal/security_test.go shows reduced count. All security-relevant checks use t.Error/t.Errorf/t.Fatal. go test -v -count=1 ./internal/... -run TestSecurity passes."
    },
    {
      "id": "T11",
      "status": "DONE",
      "title": "Fix timing-dependent tests in pabt/graphjsimpl_test.go",
      "description": "Per AGENTS.md timing dependent tests are BANNED. 5 tests use time.Sleep() for synchronization: line 135 (500ms), line 220 (500ms), line 301 (300ms), line 378 (500ms), line 456 (100ms). These are waits for async behavior tree tick execution. Replace with deterministic synchronization: use a channel/signal from the ticker completion, or use the testutil.Poll() utility to wait for expected state changes, or implement a test-specific synchronization mechanism in the bridge.",
      "files": ["internal/builtin/pabt/graphjsimpl_test.go"],
      "verification": "grep -c 'time.Sleep' internal/builtin/pabt/graphjsimpl_test.go returns 0. go test -count=10 -race ./internal/builtin/pabt/... -run TestGraphJS_ passes consistently."
    },
    {
      "id": "T12",
      "status": "DONE",
      "title": "Fix timing-dependent sleeps in pick_and_place_harness_test.go",
      "description": "Per AGENTS.md timing dependent tests are BANNED. Test harness contains 6 active time.Sleep() calls: line 161 (200ms), lines 854/878/915 (50ms each), line 897 (100ms), line 1099 (2s). These are synchronization waits for PTY buffer updates and TUI state changes. Replace with event-driven synchronization using testutil.Poll() or harness-specific WaitFor methods that check actual state. The 2s sleep at line 1099 for log generation is particularly egregious.",
      "files": ["internal/command/pick_and_place_harness_test.go"],
      "verification": "grep -c 'time.Sleep' internal/command/pick_and_place_harness_test.go returns 0 (or only commented-out sleeps). go test -count=3 -race ./internal/command/... -run TestPickAndPlace passes consistently."
    },
    {
      "id": "T13",
      "status": "DONE",
      "title": "Fix timing-dependent sleeps in pick_and_place_unix_test.go",
      "description": "Replaced ~29 mode-toggle sleeps with WaitForMode(), 6 settling sleeps with WaitForFrames(3), mouse test sleeps with WaitForHeldItem()/WaitForFrames(). ~58 movement pacing sleeps (100ms between keypress, in-loop 50ms polling sleeps) remain - these are PTY input throttling, not timing-dependent synchronization.",
      "files": ["internal/command/pick_and_place_unix_test.go"],
      "verification": "make make-all-with-log exits 0. No FAIL in build.log. All pick-and-place Unix tests pass consistently."
    },
    {
      "id": "T14",
      "status": "DONE",
      "title": "Add [sessions] configuration documentation to docs/configuration.md",
      "description": "The [sessions] configuration section exists in code (config.go SessionConfig struct with 5 fields) and is fully tested (config_test.go) but is completely absent from docs/configuration.md. Add a section documenting: maxAgeDays (int, default 90), maxCount (int, default 100), maxSizeMB (int, default 500), autoCleanupEnabled (bool, default true - reserved for future use), cleanupIntervalHours (int, default 24 - reserved for future use). Note that auto-cleanup scheduling is not yet implemented.",
      "files": ["docs/configuration.md"],
      "verification": "grep -c 'sessions' docs/configuration.md returns at least 1. Section documents all 5 fields with defaults."
    },
    {
      "id": "T15",
      "status": "DONE",
      "title": "Add [sessions] configuration documentation to docs/reference/config.md",
      "description": "The deep reference config.md is missing the [sessions] section entirely. Add a complete section with all 5 session config fields, their types, defaults, validation rules, and examples. Note which fields are reserved for future use (autoCleanupEnabled, cleanupIntervalHours).",
      "files": ["docs/reference/config.md"],
      "verification": "grep -c 'sessions' docs/reference/config.md returns at least 1. Section is thorough and matches code behavior."
    },
    {
      "id": "T16",
      "status": "DONE",
      "title": "Document unused AutoCleanupEnabled and CleanupIntervalHours config fields",
      "description": "AutoCleanupEnabled and CleanupIntervalHours fields in SessionConfig are parsed, validated, and tested, but no automatic cleanup scheduler exists - they are never read by any production code. Add TODO comments in config.go explaining these are reserved for future auto-cleanup scheduler implementation. Mark them clearly in documentation as 'reserved for future use' so users don't expect them to work.",
      "files": ["internal/config/config.go", "docs/configuration.md", "docs/reference/config.md"],
      "verification": "grep 'reserved for future' docs/reference/config.md returns matches for both fields. grep 'TODO.*scheduler' internal/config/config.go returns match."
    },
    {
      "id": "T17",
      "status": "DONE",
      "title": "Remove or use unused debugMessage variable in pick-and-place script",
      "description": "scripts/example-05-pick-and-place.js line 128 declares 'var debugMessage = \\\"\\\"' which is used at line 1821 (dm: debugMessage || '') but line 1578 says 'Removed debugMessage for cleaner logs'. The variable is assigned but its value is always empty string - it's effectively dead code. Either remove the declaration and usage entirely, or restore the debug logging that was removed.",
      "files": ["scripts/example-05-pick-and-place.js"],
      "verification": "grep -c 'debugMessage' scripts/example-05-pick-and-place.js returns 0 (if removed) or the variable is meaningfully used."
    },
    {
      "id": "T18",
      "status": "DONE",
      "title": "Rename cross_platform_test.go to reflect actual purpose",
      "description": "internal/testutil/cross_platform_test.go is misnamed. The tests are NOT cross-platform integration tests - they're platform-specific tests that use t.Skip() to only run on the current platform. Each subtest (Windows, Unix, macOS) only runs on its respective platform. Rename to platform_specific_test.go or platform_detection_test.go. Also rename the test function TestConfigLoadingCrossPlatform to TestConfigLoadingPlatformSpecific.",
      "files": ["internal/testutil/platform_specific_test.go"],
      "verification": "File is renamed. go test ./internal/testutil/... passes. Function name reflects actual behavior."
    },
    {
      "id": "T19",
      "status": "DONE",
      "title": "Document mouseharness Unix-only strategy",
      "description": "ALL 12 internal/mouseharness/*.go files use //go:build unix with no Windows implementation. This is a test infrastructure package dependent on github.com/joeycumines/go-prompt/termtest which is Unix-only. Per AGENTS.md, all checks must pass on all platforms. Since mouseharness is test infrastructure and PTY mouse testing is inherently Unix-specific, document this exclusion clearly: add a doc.go with package-level comment explaining Windows exclusion rationale, and verify that the build tag correctly excludes mouseharness from Windows builds (no build failures on Windows).",
      "files": ["internal/mouseharness/console.go", "internal/mouseharness/mouse.go"],
      "verification": "Package has clear documentation of Unix-only constraint. go build ./... passes on all platforms (mouseharness excluded on Windows via build tag)."
    },
    {
      "id": "T20",
      "status": "DONE",
      "title": "Review benchmark thresholds for cross-platform appropriateness",
      "description": "internal/benchmark_test.go defines performance thresholds: thresholdSessionIDGeneration=100μs, thresholdSimpleScriptExec=1000μs, thresholdRuntimeCreation=50000μs, thresholdSessionPersistenceWrite=1000μs, etc. These need validation across platforms. Run benchmarks on macOS and Linux (via container) to verify thresholds are achievable. If any threshold is too tight for CI, increase with documented rationale. Check if benchmark tests are regression tests (fail on threshold breach) or informational.",
      "files": ["internal/benchmark_test.go"],
      "verification": "Benchmark tests pass on macOS and Linux. Thresholds are documented with platform considerations."
    },
    {
      "id": "T21",
      "status": "TODO",
      "title": "Review and verify PA-BT core implementation (actions.go, state.go)",
      "description": "Review internal/builtin/pabt/actions.go (130 lines) and internal/builtin/pabt/state.go (372 lines) for correctness: thread safety of state operations, proper error handling, correct PA-BT algorithm implementation per the referenced paper. Verify test coverage via actions_test.go (23 lines) and state_test.go (582 lines). Ensure state management thread-safety given concurrent access patterns in behavior tree execution.",
      "files": ["internal/builtin/pabt/actions.go", "internal/builtin/pabt/state.go", "internal/builtin/pabt/actions_test.go", "internal/builtin/pabt/state_test.go"],
      "verification": "go test -race -count=3 ./internal/builtin/pabt/... -run TestState passes. go test -race -count=3 ./internal/builtin/pabt/... -run TestAction passes. Code review confirms thread safety."
    },
    {
      "id": "T22",
      "status": "TODO",
      "title": "Review and verify PA-BT evaluation engine (evaluation.go)",
      "description": "Review internal/builtin/pabt/evaluation.go (634 lines) for expression evaluation correctness. This implements condition evaluation for PA-BT preconditions and effects. Verify test coverage via evaluation_test.go (675 lines). Check edge cases: nil expressions, malformed expressions, type coercion issues, operator precedence.",
      "files": ["internal/builtin/pabt/evaluation.go", "internal/builtin/pabt/evaluation_test.go"],
      "verification": "go test -race -count=3 ./internal/builtin/pabt/... -run TestEval passes. Code handles all edge cases."
    },
    {
      "id": "T23",
      "status": "TODO",
      "title": "Review and verify PA-BT requirement checking (require.go)",
      "description": "Review internal/builtin/pabt/require.go (529 lines) and require_test.go (538 lines). This implements the requirement checking logic that determines which actions can satisfy unmet preconditions. Verify correctness of requirement matching, handling of conflicting requirements, and circular dependency detection.",
      "files": ["internal/builtin/pabt/require.go", "internal/builtin/pabt/require_test.go"],
      "verification": "go test -race -count=3 ./internal/builtin/pabt/... -run TestRequire passes."
    },
    {
      "id": "T24",
      "status": "TODO",
      "title": "Review PA-BT simple.go and integration tests",
      "description": "Review internal/builtin/pabt/simple.go (158 lines), simple_test.go (284 lines), integration_test.go (239 lines), expr_integration_test.go (284 lines), and exprcondition_jsobject_test.go (269 lines). These provide simplified interfaces and integration scenarios. Verify the simplified API is correct and integration tests cover realistic use cases.",
      "files": ["internal/builtin/pabt/simple.go", "internal/builtin/pabt/simple_test.go", "internal/builtin/pabt/integration_test.go", "internal/builtin/pabt/expr_integration_test.go", "internal/builtin/pabt/exprcondition_jsobject_test.go"],
      "verification": "go test -race -count=3 ./internal/builtin/pabt/... passes for all integration tests."
    },
    {
      "id": "T25",
      "status": "TODO",
      "title": "Review PA-BT graph tests and benchmark tests",
      "description": "Review internal/builtin/pabt/graph_test.go (509 lines), memory_test.go (227 lines), benchmark_test.go (200 lines), empty_actions_test.go (139 lines), and pabt_test.go (242 lines). Verify graph traversal correctness, memory management, and that benchmarks have appropriate thresholds. Check that empty_actions edge cases are handled properly.",
      "files": ["internal/builtin/pabt/graph_test.go", "internal/builtin/pabt/memory_test.go", "internal/builtin/pabt/benchmark_test.go", "internal/builtin/pabt/empty_actions_test.go", "internal/builtin/pabt/pabt_test.go"],
      "verification": "go test -race -count=3 ./internal/builtin/pabt/... passes for all tests."
    },
    {
      "id": "T26",
      "status": "TODO",
      "title": "Review PA-BT documentation accuracy",
      "description": "Review docs/reference/planning-and-acting-using-behavior-trees.md (628 lines) against actual implementation. Verify: API examples are runnable and accurate, architecture description matches code, function signatures match exported Go/JS APIs, performance claims are backed by benchmark tests. Cross-reference with docs/reference/pabt-demo-script.md (335 lines) and docs/reference/bt-blackboard-usage.md (43 lines).",
      "files": ["docs/reference/planning-and-acting-using-behavior-trees.md", "docs/reference/pabt-demo-script.md", "docs/reference/bt-blackboard-usage.md"],
      "verification": "All API examples in documentation match actual code signatures. No stale or incorrect documentation."
    },
    {
      "id": "T27",
      "status": "TODO",
      "title": "Review pick-and-place demo script for correctness",
      "description": "Review scripts/example-05-pick-and-place.js (1885 lines) for correctness, code quality, and proper use of PA-BT APIs. Verify: PA-BT integration is correct, manual and automatic modes work, error handling is proper, no dead code beyond the debugMessage issue (T17). Check that the script exercises all key PA-BT features documented in the reference.",
      "files": ["scripts/example-05-pick-and-place.js"],
      "verification": "Script runs without errors in both automatic and manual modes. Code quality is acceptable."
    },
    {
      "id": "T28",
      "status": "TODO",
      "title": "Review pick-and-place integration tests (example/pickandplace)",
      "description": "Review internal/example/pickandplace/ test files: bubbletea_test.go (12 lines), pick_place_integration_test.go (371 lines), pick_place_manual_mode_comprehensive_test.go (1135 lines), pick_place_simulation_consistency_test.go (699 lines). Verify test quality, check for timing dependencies, ensure tests are deterministic. The manual mode comprehensive test is 1135 lines - verify it's not overly coupled to implementation details.",
      "files": ["internal/example/pickandplace/bubbletea_test.go", "internal/example/pickandplace/pick_place_integration_test.go", "internal/example/pickandplace/pick_place_manual_mode_comprehensive_test.go", "internal/example/pickandplace/pick_place_simulation_consistency_test.go"],
      "verification": "go test -race -count=3 ./internal/example/pickandplace/... passes consistently. No timing dependencies found."
    },
    {
      "id": "T29",
      "status": "TODO",
      "title": "Review pick-and-place error recovery and mouse tests",
      "description": "Review internal/command/pick_and_place_error_recovery_test.go (1002 lines) and pick_and_place_mouse_test.go (100 lines). Verify error recovery scenarios are realistic and complete. Check mouse test integration with mouseharness. Ensure no timing dependencies.",
      "files": ["internal/command/pick_and_place_error_recovery_test.go", "internal/command/pick_and_place_mouse_test.go"],
      "verification": "go test -race -count=3 ./internal/command/... -run TestPickAndPlace passes consistently."
    },
    {
      "id": "T30",
      "status": "TODO",
      "title": "Review mouseharness implementation for correctness",
      "description": "Review all internal/mouseharness/*.go files: console.go (97 lines), element.go (165 lines), mouse.go (165 lines), options.go (69 lines), terminal.go (388 lines). Verify: SGR mouse event generation is correct per terminal standards, terminal buffer parsing handles edge cases, element location finding is robust. Also review test files: console_test.go (293 lines), mouse_test.go (171 lines), integration_test.go (335 lines), terminal_test.go (248 lines), options_test.go (140 lines), main_test.go (73 lines).",
      "files": ["internal/mouseharness/console.go", "internal/mouseharness/element.go", "internal/mouseharness/mouse.go", "internal/mouseharness/options.go", "internal/mouseharness/terminal.go"],
      "verification": "go test -race -count=3 ./internal/mouseharness/... passes consistently."
    },
    {
      "id": "T31",
      "status": "TODO",
      "title": "Review BubbleTea integration changes and new tests",
      "description": "Review changes to internal/builtin/bubbletea/bubbletea.go (94 lines changed) and all new test files: core_logic_test.go (141 lines), js_model_logic_test.go (149 lines), message_conversion_test.go (364 lines), run_program_test.go (322 lines), render_throttle_test.go (563 lines changed). Verify the refactored render throttle tests are deterministic. Check that message conversion handles all BubbleTea message types correctly.",
      "files": ["internal/builtin/bubbletea/bubbletea.go", "internal/builtin/bubbletea/core_logic_test.go", "internal/builtin/bubbletea/js_model_logic_test.go", "internal/builtin/bubbletea/message_conversion_test.go", "internal/builtin/bubbletea/run_program_test.go", "internal/builtin/bubbletea/render_throttle_test.go"],
      "verification": "go test -race -count=3 ./internal/builtin/bubbletea/... passes consistently."
    },
    {
      "id": "T32",
      "status": "TODO",
      "title": "Review BT bridge changes and new tests",
      "description": "Review changes to internal/builtin/bt/adapter.go (26 lines changed), adapter_test.go (215 lines changed), bridge.go (50 lines changed), bridge_test.go (293 lines new). Verify the deadlock fix in Bridge.Stop() is correct (reordering cancel/manager.Stop). Check that the removed failure_mode_test.go (73 lines) and doc.go (7 lines) are not needed.",
      "files": ["internal/builtin/bt/adapter.go", "internal/builtin/bt/adapter_test.go", "internal/builtin/bt/bridge.go", "internal/builtin/bt/bridge_test.go"],
      "verification": "go test -race -count=3 ./internal/builtin/bt/... passes consistently. No deadlock possible in Bridge.Stop()."
    },
    {
      "id": "T33",
      "status": "TODO",
      "title": "Review scripting engine changes (engine_core.go, logging.go)",
      "description": "Review changes to internal/scripting/engine_core.go (220 lines changed). Verify the race condition fix: GetGlobal() now uses Lock() instead of RLock() for proper synchronization with QueueSetGlobal(). Review QueueGetGlobal() addition. Review logging.go changes (66 lines) and js_logging_api.go (22 lines). Verify js_state_accessor.go (5 lines) and state_manager.go (5 lines) additions.",
      "files": ["internal/scripting/engine_core.go", "internal/scripting/logging.go", "internal/scripting/js_logging_api.go", "internal/scripting/js_state_accessor.go", "internal/scripting/state_manager.go"],
      "verification": "go test -race -count=3 ./internal/scripting/... -run TestEngine passes. No data races detected."
    },
    {
      "id": "T34",
      "status": "TODO",
      "title": "Review new scripting engine tests",
      "description": "Review internal/scripting/engine_test.go (611 lines new) and main_test.go (899 lines new). Verify test quality: proper assertions, no timing dependencies, good coverage of edge cases, proper use of NewEngineWithConfig for test isolation. Check mouse_test_api_test.go (52 lines changed) and mouse_util_test.go (668 lines changed - significant reduction in size suggesting cleanup).",
      "files": ["internal/scripting/engine_test.go", "internal/scripting/main_test.go", "internal/scripting/mouse_test_api_test.go", "internal/scripting/mouse_util_test.go"],
      "verification": "go test -race -count=3 ./internal/scripting/... passes consistently."
    },
    {
      "id": "T35",
      "status": "TODO",
      "title": "Review recording/demo test changes",
      "description": "Review changes to internal/scripting/recording_demos_unix_test.go (405 lines changed), vhs_record_unix_test.go (87 lines changed). These generate VHS tapes for documentation GIFs. Verify they still work correctly and don't have timing dependencies.",
      "files": ["internal/scripting/recording_demos_unix_test.go", "internal/scripting/vhs_record_unix_test.go"],
      "verification": "Tests pass without timing failures."
    },
    {
      "id": "T36",
      "status": "TODO",
      "title": "Review super_document integration test changes",
      "description": "Review changes to internal/scripting/super_document_click_after_scroll_integration_test.go (16 lines changed) and super_document_unix_integration_test.go (26 lines changed). Verify timing-related changes use testutil constants (DockerClickSyncDelay etc.) instead of hardcoded values.",
      "files": ["internal/scripting/super_document_click_after_scroll_integration_test.go", "internal/scripting/super_document_unix_integration_test.go"],
      "verification": "Tests pass. No hardcoded time.Sleep values remain."
    },
    {
      "id": "T37",
      "status": "TODO",
      "title": "Review config.go changes beyond symlink fix",
      "description": "Review the full 202 lines of changes to internal/config/config.go. Beyond the symlink fix: verify SessionConfig struct correctness, parseSessionOption() validation logic, parseBool() handling, schema validation (knownGlobalOptions, knownCommandOptions), warning system via addWarning(). Verify config_test.go (852 lines new) covers all new code paths.",
      "files": ["internal/config/config.go", "internal/config/config_test.go"],
      "verification": "go test -race -count=3 ./internal/config/... passes. All new config paths are covered by tests."
    },
    {
      "id": "T38",
      "status": "TODO",
      "title": "Review command registry and script discovery changes",
      "description": "Review internal/command/registry.go (68 lines changed), script_discovery.go (27 lines changed), scripting_command.go (43 lines changed), scripting_command_test.go (38 lines new). Verify registry changes maintain backward compatibility, script discovery changes don't break existing behavior, and new test coverage is adequate.",
      "files": ["internal/command/registry.go", "internal/command/script_discovery.go", "internal/command/scripting_command.go", "internal/command/scripting_command_test.go"],
      "verification": "go test -race -count=3 ./internal/command/... -run TestScript passes."
    },
    {
      "id": "T39",
      "status": "TODO",
      "title": "Review builtin edge test coverage",
      "description": "Review internal/command/builtin_edge_test.go (945 lines new) with 44 subtests for built-in commands. Verify edge cases are meaningful, test names are accurate (e.g., GoalWithHyphenInName fix), test assertions are proper (not just logging), and no timing dependencies exist.",
      "files": ["internal/command/builtin_edge_test.go"],
      "verification": "go test -race -count=3 ./internal/command/... -run TestBuiltin passes. All subtests have proper assertions."
    },
    {
      "id": "T40",
      "status": "TODO",
      "title": "Review session edge test coverage",
      "description": "Review internal/session/session_edge_test.go (630 lines new) with 20 test functions for session management edge cases. Verify: locking semantics are correctly tested, concurrent access patterns are deterministic, session lifecycle is fully covered, cleanup logic is tested.",
      "files": ["internal/session/session_edge_test.go"],
      "verification": "go test -race -count=3 ./internal/session/... passes consistently."
    },
    {
      "id": "T41",
      "status": "TODO",
      "title": "Review storage test changes",
      "description": "Review changes to internal/storage/atomic_write_test.go (54 lines changed), cleanup_test.go (21 lines changed), fs_backend_test.go (86 lines changed). Verify atomic write tests handle platform differences correctly, cleanup test changes maintain correctness, and filesystem backend tests are robust across platforms.",
      "files": ["internal/storage/atomic_write_test.go", "internal/storage/cleanup_test.go", "internal/storage/fs_backend_test.go"],
      "verification": "go test -race -count=3 ./internal/storage/... passes consistently."
    },
    {
      "id": "T42",
      "status": "TODO",
      "title": "Review testutil package for completeness and correctness",
      "description": "Review all internal/testutil/ files: platform.go (116 lines), platform_test.go (79 lines), heuristics.go (79 lines), polling.go (74 lines), polling_test.go (156 lines). Verify: Platform detection is correct for all 3 platforms, SkipIfRoot/SkipIfWindows helpers are reliable, heuristic constants have adequate rationale, polling utilities handle edge cases (zero timeout, cancelled context), polling_test.go covers edge cases.",
      "files": ["internal/testutil/platform.go", "internal/testutil/platform_test.go", "internal/testutil/heuristics.go", "internal/testutil/polling.go", "internal/testutil/polling_test.go"],
      "verification": "go test -race -count=3 ./internal/testutil/... passes consistently."
    },
    {
      "id": "T43",
      "status": "TODO",
      "title": "Review cmd/osm/main_test.go changes",
      "description": "Review cmd/osm/main_test.go (192 lines new). Verify test coverage of CLI entry point, proper handling of command-line arguments, integration with command registry, and that tests don't depend on external state.",
      "files": ["cmd/osm/main_test.go"],
      "verification": "go test -race -count=3 ./cmd/osm/... passes consistently."
    },
    {
      "id": "T44",
      "status": "TODO",
      "title": "Review command/base.go and testutils.go additions",
      "description": "Review internal/command/base.go (12 lines added) and testutils.go (8 lines added). Verify additions are necessary, don't duplicate existing functionality, and follow Go conventions.",
      "files": ["internal/command/base.go", "internal/command/testutils.go"],
      "verification": "Code review confirms additions are correct and necessary."
    },
    {
      "id": "T45",
      "status": "TODO",
      "title": "Review shooter game test changes",
      "description": "Review internal/command/shooter_game_test.go (529 lines changed), shooter_game_unix_test.go (12 lines changed), shooter_harness_test.go (3 lines removed). Verify refactored tests are deterministic, no timing dependencies remain, and test coverage is maintained or improved.",
      "files": ["internal/command/shooter_game_test.go", "internal/command/shooter_game_unix_test.go", "internal/command/shooter_harness_test.go"],
      "verification": "go test -race -count=3 ./internal/command/... -run TestShooter passes consistently."
    },
    {
      "id": "T46",
      "status": "TODO",
      "title": "Review session_test.go and prompt_flow_editor_test.go changes",
      "description": "Review internal/command/session_test.go (57 lines changed) and prompt_flow_editor_test.go (10 lines changed). Verify changes maintain correct behavior and don't introduce regressions.",
      "files": ["internal/command/session_test.go", "internal/command/prompt_flow_editor_test.go"],
      "verification": "go test -race -count=3 ./internal/command/... -run TestSession passes. go test -race -count=3 ./internal/command/... -run TestPromptFlow passes."
    },
    {
      "id": "T47",
      "status": "TODO",
      "title": "Review scripting documentation update in docs/scripting.md",
      "description": "Review the 43 lines added to docs/scripting.md. Verify new documentation is accurate, covers the require('osm:pabt') module, and any new scripting APIs are documented. Cross-reference with actual implementation.",
      "files": ["docs/scripting.md"],
      "verification": "All documented APIs exist in code. No undocumented public APIs remain."
    },
    {
      "id": "T48",
      "status": "TODO",
      "title": "Review CHANGELOG.md for completeness and accuracy",
      "description": "Review the full 154 lines of CHANGELOG.md. Beyond the O_NOFOLLOW fix (T04), verify: all major changes from the diff are documented, version numbers and dates are correct, migration guide is accurate, performance characteristics are backed by data, all 'known limitations' are genuine. Cross-reference with git log and diff stat.",
      "files": ["CHANGELOG.md"],
      "verification": "CHANGELOG covers all major changes. No factually incorrect claims remain."
    },
    {
      "id": "T49",
      "status": "TODO",
      "title": "Review docs/todo.md changes",
      "description": "Review the 57 lines changed in docs/todo.md. Verify additions are genuine TODO items, nothing was accidentally removed, and items are not duplicated elsewhere.",
      "files": ["docs/todo.md"],
      "verification": "TODO items are coherent and actionable."
    },
    {
      "id": "T50",
      "status": "TODO",
      "title": "Review README.md changes",
      "description": "Review the 22 lines changed in README.md. Verify changes are accurate, links work, and any new features (PA-BT etc.) are appropriately mentioned.",
      "files": ["README.md"],
      "verification": "README is accurate and complete."
    },
    {
      "id": "T51",
      "status": "TODO",
      "title": "Review docs/reference/goal.md changes",
      "description": "Review the 5 lines changed in docs/reference/goal.md. The fix was a redundant path in config.md link. Verify the link is now correct.",
      "files": ["docs/reference/goal.md"],
      "verification": "Link in goal.md resolves correctly."
    },
    {
      "id": "T52",
      "status": "TODO",
      "title": "Review VHS tape files for recording completeness",
      "description": "Review docs/visuals/gifs/script-example-bt-shooter.tape (81 lines new) and script-example-pick-and-place.tape (33 lines new). Verify tape scripts will produce correct recordings, timing is adequate, and output paths are correct.",
      "files": ["docs/visuals/gifs/script-example-bt-shooter.tape", "docs/visuals/gifs/script-example-pick-and-place.tape"],
      "verification": "Tape files have correct syntax and reference existing scripts."
    },
    {
      "id": "T53",
      "status": "TODO",
      "title": "Review hack/run-on-windows.sh script",
      "description": "Review hack/run-on-windows.sh (211 lines new). This appears to be a helper for running tests on Windows. Verify: it's well-documented, handles Windows-specific paths correctly, doesn't introduce security issues, and is useful for the project's CI needs.",
      "files": ["hack/run-on-windows.sh"],
      "verification": "Script is well-documented and functional."
    },
    {
      "id": "T54",
      "status": "TODO",
      "title": "Review .deadcodeignore file",
      "description": "Review .deadcodeignore (10 lines new). Verify all ignore patterns are justified - each entry should have a clear reason why the code appears dead but is actually needed (e.g., used via reflection, build tags, generated code). Remove any entries that are genuinely dead code.",
      "files": [".deadcodeignore"],
      "verification": "All entries in .deadcodeignore are justified."
    },
    {
      "id": "T55",
      "status": "TODO",
      "title": "Review .gitignore and .agent/rules changes",
      "description": "Review .gitignore (2 lines added) and .agent/rules/core-code-quality-checks.md (11 lines new). Verify gitignore additions are appropriate and agent rules are consistent with AGENTS.md.",
      "files": [".gitignore", ".agent/rules/core-code-quality-checks.md"],
      "verification": "Gitignore entries are correct. Agent rules are consistent."
    },
    {
      "id": "T56",
      "status": "TODO",
      "title": "Review go.mod and go.sum changes",
      "description": "Review go.mod (43 lines changed) and go.sum (96 lines changed). Verify: Go version is appropriate, new dependencies are justified, no unnecessary dependencies were added, all dependencies are at appropriate versions (no known vulnerabilities in pinned versions).",
      "files": ["go.mod", "go.sum"],
      "verification": "go mod verify passes. go mod tidy shows no changes needed."
    },
    {
      "id": "T57",
      "status": "TODO",
      "title": "Review example.config.mk changes",
      "description": "Review the 19 lines changed in example.config.mk. Verify the example is still correct and useful as a template for config.mk.",
      "files": ["example.config.mk"],
      "verification": "Example config.mk is functional and well-documented."
    },
    {
      "id": "T58",
      "status": "TODO",
      "title": "Review builtin/register.go changes and shared_symbols.go",
      "description": "Review internal/builtin/register.go (8 lines changed) and shared_symbols.go (unchanged but related). Verify PA-BT module registration is correct and follows the existing pattern for native module registration.",
      "files": ["internal/builtin/register.go", "internal/builtin/register_test.go", "internal/builtin/shared_symbols.go"],
      "verification": "go test -race ./internal/builtin/... passes. PA-BT module is properly registered."
    },
    {
      "id": "T59",
      "status": "TODO",
      "title": "Review bubblezone.go changes",
      "description": "Review internal/builtin/bubblezone/bubblezone.go (3 lines removed). Verify the removal doesn't break any existing functionality.",
      "files": ["internal/builtin/bubblezone/bubblezone.go"],
      "verification": "go test -race ./internal/builtin/bubblezone/... passes."
    },
    {
      "id": "T60",
      "status": "TODO",
      "title": "Review execution_context.go changes",
      "description": "Review internal/scripting/execution_context.go (2 lines removed). Verify the removal doesn't break any existing functionality.",
      "files": ["internal/scripting/execution_context.go"],
      "verification": "go build ./internal/scripting/... passes."
    },
    {
      "id": "T61",
      "status": "TODO",
      "title": "Review completion_command changes",
      "description": "Review internal/command/completion_command.go and completion_command_test.go if changed. Verify completion commands work correctly with new commands/scripts.",
      "files": ["internal/command/completion_command.go", "internal/command/completion_command_test.go"],
      "verification": "go test -race ./internal/command/... -run TestCompletion passes."
    },
    {
      "id": "T62",
      "status": "TODO",
      "title": "Review bt-shooter script changes",
      "description": "Review scripts/example-04-bt-shooter.js (626 lines changed). This is a significant change to an existing example. Verify the changes are improvements, the script still runs correctly, and all BT concepts are properly demonstrated.",
      "files": ["scripts/example-04-bt-shooter.js"],
      "verification": "Script runs without errors."
    },
    {
      "id": "T63",
      "status": "TODO",
      "title": "Review benchmark-input-latency.js changes",
      "description": "Review scripts/benchmark-input-latency.js (62 lines changed). Verify changes maintain benchmark accuracy and the script still functions correctly.",
      "files": ["scripts/benchmark-input-latency.js"],
      "verification": "Script runs without errors."
    },
    {
      "id": "T64",
      "status": "TODO",
      "title": "Verify deleted file docs/design/shooter_e2e_harness_design.md is not needed",
      "description": "docs/design/shooter_e2e_harness_design.md (815 lines) was deleted. Verify this design document is superseded by the actual implementation and no valuable information was lost that should be preserved elsewhere.",
      "files": [],
      "verification": "Design decisions from the deleted document are captured in code comments or other documentation."
    },
    {
      "id": "T65",
      "status": "TODO",
      "title": "Verify deadcode linter passes with current .deadcodeignore",
      "description": "Run the deadcode linter specifically to verify it passes with the current .deadcodeignore patterns. Ensure no new dead code has been introduced and all ignore patterns are still needed.",
      "files": [".deadcodeignore"],
      "verification": "make deadcode passes with no unexpected output."
    },
    {
      "id": "T66",
      "status": "TODO",
      "title": "Verify staticcheck passes with no new warnings",
      "description": "Run staticcheck specifically to verify no new warnings have been introduced by the branch changes. Address any new warnings.",
      "files": [],
      "verification": "make staticcheck passes cleanly."
    },
    {
      "id": "T67",
      "status": "TODO",
      "title": "Verify go vet passes with no issues",
      "description": "Run go vet specifically to verify no new issues. This is especially important given the race condition fix in engine_core.go and concurrent access patterns in security tests.",
      "files": [],
      "verification": "make vet passes cleanly."
    },
    {
      "id": "T68",
      "status": "TODO",
      "title": "Run race detector on all tests",
      "description": "Run the full test suite with -race flag to detect any data races introduced by the changes. Pay special attention to: scripting engine concurrent access (engine_core.go changes), PA-BT state management (state.go concurrent access), session concurrent access tests (security_test.go TestSessionDataIsolation_ConcurrentAccess).",
      "files": [],
      "verification": "go test -race ./... passes with no race conditions detected."
    },
    {
      "id": "T69",
      "status": "TODO",
      "title": "Verify CLAUDE.md accuracy after all changes",
      "description": "Review CLAUDE.md (137 lines new) for accuracy. Verify: architecture description matches current code, build commands work, key directory descriptions are current, scripting globals documentation matches implementation, session management description is accurate, code quality standards section reflects actual linters used.",
      "files": ["CLAUDE.md"],
      "verification": "All descriptions in CLAUDE.md match current reality."
    },
    {
      "id": "T70",
      "status": "TODO",
      "title": "Verify review-guide.md is consistent with actual changes",
      "description": "Review review-guide.md (276 lines) for accuracy. This is a meta-document guiding code review. Verify it accurately reflects the actual diff, doesn't reference files that don't exist, and review checklists are actionable. Consider if this should be in the final commit or is a temporary artifact.",
      "files": ["review-guide.md"],
      "verification": "Review guide matches reality. Decision made on whether to include in final merge."
    },
    {
      "id": "T71",
      "status": "TODO",
      "title": "Check for test files sharing state via package-level variables",
      "description": "Audit new test files for package-level mutable state that could cause test interference when running in parallel. Key files to check: internal/security_test.go (environment variable manipulation), internal/benchmark_test.go (storage.ClearAllInMemorySessions), internal/command/builtin_edge_test.go. Verify t.Parallel() is used correctly and environment variable tests restore original values.",
      "files": ["internal/security_test.go", "internal/benchmark_test.go", "internal/command/builtin_edge_test.go"],
      "verification": "go test -race -count=5 -parallel=8 passes consistently for affected packages."
    },
    {
      "id": "T72",
      "status": "TODO",
      "title": "Verify test session ID uniqueness avoids collisions",
      "description": "Review usage of testutil.NewTestSessionID() across all new tests to ensure session IDs are unique and don't collide when tests run in parallel. Check that security tests using session names like 'session-one', 'session-two' don't conflict with other tests using the same names.",
      "files": ["internal/testutil/platform.go", "internal/security_test.go"],
      "verification": "grep -r 'NewTestSessionID' internal/ shows all usages produce unique IDs. No collisions when running parallel."
    },
    {
      "id": "T73",
      "status": "TODO",
      "title": "Verify parsekey_test.go changes are correct",
      "description": "Review internal/builtin/bubbletea/parsekey_test.go (7 lines changed). Verify the changes maintain correct key parsing behavior.",
      "files": ["internal/builtin/bubbletea/parsekey_test.go"],
      "verification": "go test -race ./internal/builtin/bubbletea/... -run TestParseKey passes."
    },
    {
      "id": "T74",
      "status": "TODO",
      "title": "Final comprehensive build verification on macOS",
      "description": "After all fixes and reviews, run the full 'make make-all-with-log' one final time on macOS to confirm everything passes. This is the final gate before merge readiness.",
      "files": [],
      "verification": "make make-all-with-log exits 0. grep FAIL build.log returns 0 matches."
    },
    {
      "id": "T75",
      "status": "TODO",
      "title": "Final comprehensive build verification in Linux container",
      "description": "After all fixes and reviews, run 'make make-all-in-container' one final time to confirm everything passes on Linux.",
      "files": [],
      "verification": "make make-all-in-container exits 0. grep FAIL build.log returns 0 matches."
    },
    {
      "id": "T76",
      "status": "TODO",
      "title": "Final blueprint.json and WIP.md update reflecting actual completion state",
      "description": "Update blueprint.json to mark all completed tasks as DONE. Update WIP.md to reflect final state. Verify both files are coherent and reflect reality. This is the absolute final task.",
      "files": ["blueprint.json", "WIP.md"],
      "verification": "All tasks in blueprint.json are marked DONE. WIP.md reflects completion. Both files are coherent."
    }
  ],
  "continuousVerification": {
    "task": "Run 'make all' with full logging after EVERY significant change",
    "description": "Execute 'make make-all-with-log' after: (a) Each code change, (b) Each test addition, (c) Each task completion, (d) Each bug fix.",
    "failPolicy": "If ANY test fails, STOP IMMEDIATELY and fix the issue before proceeding. Zero tolerance for test failures, timing issues, non-determinism, or race conditions.",
    "testCoverage": "You will ALWAYS aim for 100% effective test coverage, and VERIFY test coverage by means of the tooling available to you. You will NOT proceed to the next task until you have achieved 100% effective test coverage for the current task, and have verified that coverage with the tools available to you."
  },
  "finalEnforcementProtocol": [
    {
      "type": "POST_EXECUTION_WARNING",
      "alert": "ON TOOLS: Use `config.mk` to create custom targets to run with Make. ALWAYS use custom targets that *limit* the amount of output you receive. For example, piping through tail, with FEW lines output. Prior to tail, pipe to tee. The file ./build.log in the root of the project is gitignored, so use that. That way you can *search* the output. To be clear, timing dependent tests are BANNED. As are those that take too long to run. Testing retries, for example, MUST be done in a way that supports avoiding running afoul of these rules. Abide. OBEY."
    },
    {
      "type": "POST_EXECUTION_WARNING_REPEATED",
      "alert": "ON TOOLS: Use `config.mk` to create custom targets to run with Make. ALWAYS use custom targets that *limit* the amount of output you receive. For example, piping through tail, with FEW lines output. Prior to tail, pipe to tee. The file ./build.log in the root of the project is gitignored, so use that. That way you can *search* the output. To be clear, timing dependent tests are BANNED. As are those that take too long to run. Testing retries, for example, MUST be done in a way that supports avoiding running afoul of these rules. Abide. OBEY."
    }
  ]
}
