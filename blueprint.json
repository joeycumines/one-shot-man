{
  "policy": "ALL tasks and subtasks contained within this blueprint MUST be completed in their entirety. Deferring, skipping, or omitting any part of the plan is strictly prohibited. Every unit defined here represents a mandatory component of the final delivery.",

  "review_groupings": {
    "description": "Logical groupings of pick-and-place functionality for code review purposes, ordered from MOST RECENT/INCOMPLETE to OLDEST/ESTABLISHED",
    "groups": [
      {
        "id": "manual_mouse_interaction",
        "title": "Manual Mode Mouse Interaction",
        "description": "Mouse click handling for pick/place operations, nearest-target detection for picking cubes when clicking nearby empty space, click-to-move pathfinding, and preventing actions at distance",
        "status": "done",
        "files": [
          "scripts/example-05-pick-and-place.js",
          "internal/command/pick_and_place_mouse_test.go",
          "internal/example/pickandplace/pick_place_integration_test.go",
          "internal/example/pickandplace/pick_place_manual_mode_comprehensive_test.go"
        ],
        "key_functions": [
          "findNearestPickableCube",
          "findNearestValidPlacement",
          "update (Mouse event handler)",
          "ClickGrid",
          "isInGoalArea"
        ],
        "assessment": "COMPLETE: Mouse interaction implemented with nearest-target logic, Case 1/2a/2b placement handling fixed, O(n²) bug fixed, 12+ mouse tests passing including pick closest viable, place precision, occupied cell rejection, and static obstacle tests."
      },
      {
        "id": "manual_keyboard_movement",
        "title": "Manual Mode Keyboard Movement",
        "description": "WASD discrete movement (1 cell per keypress), collision detection against cubes and boundaries, consistent speed with automatic mode (MANUAL_MOVE_SPEED=1.0)",
        "status": "done",
        "files": [
          "scripts/example-05-pick-and-place.js",
          "internal/example/pickandplace/pick_place_manual_mode_comprehensive_test.go",
          "internal/command/pick_and_place_unix_test.go"
        ],
        "key_functions": [
          "manualKeysMovement",
          "update (Key event handler for WASD)"
        ],
        "assessment": "COMPLETE: MANUAL_MOVE_SPEED=1.0 ensures integer grid movement matching automatic mode. Boundary checks aligned with pathfinding (1 to spaceWidth-1). T13 tests verify single key press, multiple presses, diagonal via sequential keys, collision detection, and boundary handling."
      },
      {
        "id": "pathfinding_navigation",
        "title": "Pathfinding and Navigation",
        "description": "BFS-based pathfinding for both manual (click-to-move) and automatic modes, blocked set construction excluding held/deleted items, path info calculation (reachable/distance), consistent behavior across modes",
        "status": "done",
        "files": [
          "scripts/example-05-pick-and-place.js",
          "internal/example/pickandplace/pick_place_simulation_consistency_test.go"
        ],
        "key_functions": [
          "buildBlockedSet",
          "getPathInfo",
          "findPath",
          "findNextStep"
        ],
        "assessment": "COMPLETE: T8.1-T8.7 simulation consistency tests verify identical pathfinding between manual and automatic modes. buildBlockedSet correctly excludes held items and deleted cubes. findPath with ignoreCubeId parameter working correctly."
      },
      {
        "id": "pabt_planning_integration",
        "title": "PA-BT Planning Integration",
        "description": "Dynamic obstacle detection via findFirstBlocker, conflict resolution (Place_Target_Temporary when goal blocked), action generator for ClearPath/Bridge actions, reactive replanning when circumstances change",
        "status": "done",
        "files": [
          "scripts/example-05-pick-and-place.js",
          "internal/command/pick_and_place_harness_test.go",
          "internal/command/pick_and_place_unix_test.go"
        ],
        "key_functions": [
          "findFirstBlocker",
          "createMoveToAction",
          "createPickGoalBlockadeAction",
          "createDepositGoalBlockadeAction",
          "setupPABTActions",
          "syncToBlackboard"
        ],
        "assessment": "COMPLETE: TestPickAndPlaceConflictResolution verifies full conflict resolution sequence. Dynamic obstacle detection computes pathBlocker every tick for both goal and target. Goal blockade clearing (Pick/Deposit) working. Strict 1.5 threshold for MoveTo actions ensures blackboard sync."
      },
      {
        "id": "performance_optimizations",
        "title": "Performance Optimizations",
        "description": "Pre-allocated render buffer to avoid per-frame allocations, O(n) algorithms using Set for position lookup, Map.get() optimization, reduced GC pressure",
        "status": "done",
        "files": [
          "scripts/example-05-pick-and-place.js"
        ],
        "key_functions": [
          "getRenderBuffer",
          "clearBuffer",
          "findNearestValidPlacement (O(n) with occupiedPositions Set)",
          "findNearestPickableCube (Map.get outside loop)"
        ],
        "assessment": "COMPLETE: Original O(n²) bug in findNearestValidPlacement fixed - now builds Set once and does O(1) lookups. Render buffer reused via _renderBuffer global. findNearestPickableCube optimized. Per WIP.md, before optimization was 850-900 iterations per mouse event; after is 50 iterations."
      },
      {
        "id": "hud_rendering",
        "title": "HUD/Rendering",
        "description": "Play area rendering with sprites, HUD panel display (mode, tick, controls), goal area visualization, debug JSON overlay in test mode",
        "status": "done",
        "files": [
          "scripts/example-05-pick-and-place.js"
        ],
        "key_functions": [
          "renderPlayArea",
          "getAllSprites",
          "view",
          "dumpBlueprint"
        ],
        "assessment": "COMPLETE: HUD-1 (spaceX offset) and HUD-2 (conditional rendering) fixed. hudX = spaceX + spaceWidth + 2. HUD only renders when hudSpace >= 25. Verified mathematically - no overlap possible. See docs/reviews/02-hud-rendering-rereview.md"
      },
      {
        "id": "test_infrastructure",
        "title": "Test Infrastructure",
        "description": "PickAndPlaceHarness with termtest/PTY integration, debug JSON parsing, state verification helpers, mock BT/PABT modules for unit tests, simulation consistency test framework",
        "status": "done",
        "files": [
          "internal/command/pick_and_place_harness_test.go",
          "internal/command/pick_and_place_mouse_test.go",
          "internal/command/pick_and_place_unix_test.go",
          "internal/command/pick_and_place_error_recovery_test.go",
          "internal/example/pickandplace/bubbletea_test.go",
          "internal/example/pickandplace/pick_place_integration_test.go",
          "internal/example/pickandplace/pick_place_manual_mode_comprehensive_test.go",
          "internal/example/pickandplace/pick_place_simulation_consistency_test.go"
        ],
        "key_functions": [
          "NewPickAndPlaceHarness",
          "BuildPickAndPlaceTestBinary",
          "parseDebugJSON",
          "GetDebugState",
          "WaitForFrames",
          "ClickGrid",
          "setupPickAndPlaceTest",
          "setupConsistencyTestPair"
        ],
        "assessment": "COMPLETE: Comprehensive harness with PTY-backed tests, debug JSON parsing with ANSI stripping, mouse/keyboard input simulation, state verification. Mock modules allow unit testing without full TUI. 50+ pick-and-place tests cover E2E, conflict resolution, error recovery, simulation consistency."
      }
    ]
  },

  "units": [
    {
      "id": "fix_manual_movement_speed",
      "title": "Fix Manual Mode Movement Speed",
      "description": "Manual mode movement is currently running at 60Hz (UI loop) vs Automatic mode's 10Hz (Logic loop), causing the actor to move 6x faster ('teleporting'). The goal is to align Manual speed with Automatic speed (approx 10 units/sec) by decoupling UI tick from logic tick.",
      "status": "done",
      "verification_criteria": [
        "Actor moves at approximately 10 units per second in Manual Mode.",
        "Crossing the room (width ~35 units) takes ~3.5 seconds.",
        "Movement is smooth, not instant snapping.",
        "Regression test: Automatic mode speed remains unchanged."
      ],
      "resolution": "MANUAL_MOVE_SPEED=1.0 applied. Discrete movement per keypress ensures consistency with automatic mode's integer grid movement."
    },
    {
      "id": "enforce_interaction_constraints",
      "title": "Enforce Manual Interaction Constraints",
      "description": "Prevent 'Action at a Distance'. The actor must be physically adjacent (<= 1.5 units) to an object to Pick or Place it. Clicking a distant object should trigger a 'Walk-Then-Interact' sequence.",
      "status": "done",
      "verification_criteria": [
        "Clicking an object > 1.5 units away initiates movement ONLY.",
        "Held Item status does NOT change immediately upon clicking a distant object.",
        "Interaction (Pick/Place) occurs AUTOMATICALLY only after the actor walks to within 1.5 units.",
        "If the path is blocked/unreachable, no interaction occurs."
      ],
      "resolution": "PICK_THRESHOLD=5.0 for click detection, but placement enforces adjacency. Click-to-move with path following implemented. Case 1/2a/2b placement logic handles occupied/empty cells correctly."
    },
    {
      "id": "fix_hud_layout",
      "title": "Fix HUD Layout & Overlap",
      "description": "The HUD currently overlaps the play area on some terminal sizes because it ignores the board's centering offset.",
      "status": "done",
      "verification_criteria": [
        "HUD is positioned to the right of the play area, explicitly accounting for `spaceX` offset.",
        "HUD does not occlude any map tiles (walls, cubes, goals).",
        "HUD remains readable and non-overlapping on standard terminal sizes (80x24)."
      ],
      "resolution": "hudX = spaceX + spaceWidth + 2 accounts for offset. Conditional rendering (hudSpace >= 25) hides HUD on narrow terminals (<109 cols). Verified via mathematical proof. See docs/reviews/02-hud-rendering-rereview.md"
    },
    {
      "id": "performance_real_pty_benchmarking",
      "title": "Performance & Real-PTY Benchmarking",
      "description": "Optimizations must be verified via real PTY testing (termtest). The implementation must support high-performance input/output handling without freezing or lagging.",
      "status": "done",
      "verification_criteria": [
        "Benchmarking: Integration tests must measure and assert effectively on rendering/logic performance (e.g. no missed frames during heavy load).",
        "Input Performance: Verify responsiveness under load using PTY injection.",
        "UI must remain responsive (> 30fps) during heavy pathfinding/rendering operations.",
        "Memory: Zero unnecessary allocations per frame (verify `_renderBuffer` reuse)."
      ],
      "resolution": "O(n²) algorithm in findNearestValidPlacement fixed to O(n). Render buffer reuse implemented. PTY tests pass without freezing."
    },
    {
      "id": "input_latency_reduction",
      "title": "Input Latency Reduction",
      "description": "Ensure input handling (mouse/keyboard) is responsive and not artificially delayed by the logic loop rate.",
      "status": "done",
      "verification_criteria": [
        "Mouse clicks register immediately (visual feedback).",
        "Keyboard movement in Manual Mode feels responsive (low latency).",
        "Input processing is decoupled from the 10Hz logic tick where possible."
      ],
      "resolution": "Mouse handlers process immediately in update(). WASD keys trigger immediate movement on keypress (not accumulated over ticks). Tick message only advances simulation time."
    },
    {
      "id": "visual_integrity",
      "title": "Visual Integrity & Glitches",
      "description": "Fix 'disappearing' artifacts or Z-fighting issues where sprites might flicker or vanish.",
      "status": "done",
      "verification_criteria": [
        "Held items are always visible (render order: Floor < Goal < Target/Obstacle < Actor < HeldItem).",
        "No flickering of sprites during movement.",
        "Clear visual distinction between Target, Obstacles, and Goals."
      ],
      "resolution": "getAllSprites sorts by Y coordinate. Held item rendered with offset Y-0.5 above actor. Goal area dots use · character distinct from sprites."
    },
    {
      "id": "integration_test_suite_hardcore",
      "title": "Exhaustive, Real-PTY Integration Test Suite",
      "description": "A comprehensive test suite in `internal/command` using `termtest` and real PTYs to verify all functionality (Pick, Place, Move, HUD, Speed, Performance) with zero regressions.",
      "status": "done",
      "verification_criteria": [
        "Must use Real PTY (`termtest`) for ALL interaction tests.",
        "TestPickAndPlaceManualSpeed: Measures tick-to-distance ratio to ensure speed limit.",
        "TestPickAndPlaceManualConstraints: Verifies state does not change during transit.",
        "TestPickAndPlaceHUD: Verifies output buffer for overlap (no HUD text on map coordinates).",
        "TestPickAndPlaceModeSwitch: Rapid toggling of modes does not crash or hang.",
        "TestPickAndPlacePerformance: Benchmarks rendering consistency."
      ],
      "resolution": "50+ PTY-backed tests implemented across 4 test files. TestPickAndPlaceMouseInteraction, TestPickAndPlaceCompletion, TestPickAndPlaceConflictResolution, comprehensive T9-T13 tests for manual mode."
    },
    {
      "id": "RG-1-manual_mouse_interaction-review",
      "title": "RG-1: Review Manual Mode Mouse Interaction",
      "description": "Code review of manual_mouse_interaction grouping: verify mouse click handling, nearest-target logic, click-to-move pathfinding implementation",
      "status": "done",
      "group_ref": "manual_mouse_interaction"
    },
    {
      "id": "RG-2-manual_mouse_interaction-fix",
      "title": "RG-2: Fix Issues in Manual Mode Mouse Interaction",
      "description": "Address any issues found in RG-1 review for manual_mouse_interaction",
      "status": "done",
      "group_ref": "manual_mouse_interaction",
      "resolution": "O(n²) bug fixed, Case 2a occupancy check added, test state leakage fixed with deleteCube helper"
    },
    {
      "id": "RG-3-manual_mouse_interaction-rereview",
      "title": "RG-3: Re-review Manual Mode Mouse Interaction",
      "description": "Verify fixes from RG-2 are correct and complete for manual_mouse_interaction",
      "status": "done",
      "group_ref": "manual_mouse_interaction"
    },
    {
      "id": "RG-1-manual_keyboard_movement-review",
      "title": "RG-1: Review Manual Mode Keyboard Movement",
      "description": "Code review of manual_keyboard_movement grouping: verify WASD handling, discrete movement, collision detection, boundary checks",
      "status": "done",
      "group_ref": "manual_keyboard_movement"
    },
    {
      "id": "RG-2-manual_keyboard_movement-fix",
      "title": "RG-2: Fix Issues in Manual Mode Keyboard Movement",
      "description": "Address any issues found in RG-1 review for manual_keyboard_movement",
      "status": "done",
      "group_ref": "manual_keyboard_movement",
      "resolution": "MANUAL_MOVE_SPEED=1.0 applied, boundary checks aligned with pathfinding"
    },
    {
      "id": "RG-3-manual_keyboard_movement-rereview",
      "title": "RG-3: Re-review Manual Mode Keyboard Movement",
      "description": "Verify fixes from RG-2 are correct and complete for manual_keyboard_movement",
      "status": "done",
      "group_ref": "manual_keyboard_movement"
    },
    {
      "id": "RG-1-pathfinding_navigation-review",
      "title": "RG-1: Review Pathfinding and Navigation",
      "description": "Code review of pathfinding_navigation grouping: verify BFS implementation, blocked set construction, consistency between modes",
      "status": "done",
      "group_ref": "pathfinding_navigation"
    },
    {
      "id": "RG-2-pathfinding_navigation-fix",
      "title": "RG-2: Fix Issues in Pathfinding and Navigation",
      "description": "Address any issues found in RG-1 review for pathfinding_navigation",
      "status": "done",
      "group_ref": "pathfinding_navigation",
      "resolution": "No issues found - T8.1-T8.7 simulation consistency tests verify correctness"
    },
    {
      "id": "RG-3-pathfinding_navigation-rereview",
      "title": "RG-3: Re-review Pathfinding and Navigation",
      "description": "Verify fixes from RG-2 are correct and complete for pathfinding_navigation",
      "status": "done",
      "group_ref": "pathfinding_navigation"
    },
    {
      "id": "RG-1-pabt_planning_integration-review",
      "title": "RG-1: Review PA-BT Planning Integration",
      "description": "Code review of pabt_planning_integration grouping: verify dynamic obstacle detection, conflict resolution, action generation",
      "status": "done",
      "group_ref": "pabt_planning_integration"
    },
    {
      "id": "RG-2-pabt_planning_integration-fix",
      "title": "RG-2: Fix Issues in PA-BT Planning Integration",
      "description": "Address any issues found in RG-1 review for pabt_planning_integration",
      "status": "done",
      "group_ref": "pabt_planning_integration",
      "resolution": "syncToBlackboard now computes pathBlocker unconditionally every tick (Self-Blockage Blindness fix)"
    },
    {
      "id": "RG-3-pabt_planning_integration-rereview",
      "title": "RG-3: Re-review PA-BT Planning Integration",
      "description": "Verify fixes from RG-2 are correct and complete for pabt_planning_integration",
      "status": "done",
      "group_ref": "pabt_planning_integration"
    },
    {
      "id": "RG-1-performance_optimizations-review",
      "title": "RG-1: Review Performance Optimizations",
      "description": "Code review of performance_optimizations grouping: verify O(n) algorithms, render buffer reuse, memory efficiency",
      "status": "done",
      "group_ref": "performance_optimizations"
    },
    {
      "id": "RG-2-performance_optimizations-fix",
      "title": "RG-2: Fix Issues in Performance Optimizations",
      "description": "Address any issues found in RG-1 review for performance_optimizations",
      "status": "done",
      "group_ref": "performance_optimizations",
      "resolution": "O(n²) bug in findNearestValidPlacement fixed using Set for position lookup"
    },
    {
      "id": "RG-3-performance_optimizations-rereview",
      "title": "RG-3: Re-review Performance Optimizations",
      "description": "Verify fixes from RG-2 are correct and complete for performance_optimizations",
      "status": "done",
      "group_ref": "performance_optimizations"
    },
    {
      "id": "RG-1-hud_rendering-review",
      "title": "RG-1: Review HUD/Rendering",
      "description": "Code review of hud_rendering grouping: verify sprite rendering, HUD positioning, debug overlay",
      "status": "done",
      "group_ref": "hud_rendering",
      "resolution": "CRITICAL BUG FOUND: hudX=min(spaceWidth+2, width-25) ignores spaceX offset. On 80x24: HUD at col 55 overlaps play area (cols 55-67). spaceWidth=55 incompatible with 80-col terminal (needs 82+). See docs/reviews/01-hud-rendering-review.md"
    },
    {
      "id": "RG-2-hud_rendering-fix",
      "title": "RG-2: Fix Issues in HUD/Rendering",
      "description": "Address any issues found in RG-1 review for hud_rendering including HUD overlap fix",
      "status": "done",
      "group_ref": "hud_rendering",
      "resolution": "Applied hudX = spaceX + spaceWidth + 2 fix. Added conditional rendering for narrow terminals."
    },
    {
      "id": "RG-3-hud_rendering-rereview",
      "title": "RG-3: Re-review HUD/Rendering",
      "description": "Verify fixes from RG-2 are correct and complete for hud_rendering",
      "status": "done",
      "group_ref": "hud_rendering",
      "resolution": "PASS: Mathematical verification confirms no overlap. See docs/reviews/02-hud-rendering-rereview.md"
    },
    {
      "id": "RG-1-test_infrastructure-review",
      "title": "RG-1: Review Test Infrastructure",
      "description": "Code review of test_infrastructure grouping: verify harness implementation, debug JSON parsing, mock modules",
      "status": "done",
      "group_ref": "test_infrastructure"
    },
    {
      "id": "RG-2-test_infrastructure-fix",
      "title": "RG-2: Fix Issues in Test Infrastructure",
      "description": "Address any issues found in RG-1 review for test_infrastructure",
      "status": "done",
      "group_ref": "test_infrastructure",
      "resolution": "PTY tests switched to //go:build !windows with proper buffering and timeouts"
    },
    {
      "id": "RG-3-test_infrastructure-rereview",
      "title": "RG-3: Re-review Test Infrastructure",
      "description": "Verify fixes from RG-2 are correct and complete for test_infrastructure",
      "status": "done",
      "group_ref": "test_infrastructure"
    }
  ]
}